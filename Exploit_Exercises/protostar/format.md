# Exploit-Exercises Protostar Writeup - Format

## Before Start
If you don't have much experience in Format String Attack, I recommend you to go through the following reading materials.      
[Format String Attack](https://www.owasp.org/index.php/Format_string_attack)    
[Stanford CS115 Paper About Format String Vulnerabilities](https://crypto.stanford.edu/cs155/papers/formatstring-1.2.pdf)        
[An Abstract Version](http://www.cis.syr.edu/~wedu/Teaching/cis643/LectureNotes_New/Format_String.pdf)

## [Format0](https://exploit-exercises.com/protostar/format0/)
This one can be done with stack overflow. ```./format0 $(python -c "print 'A'*64+'\xef\xbe\xad\xde'")```.     
But.. No! We should exploit format string vulnerabilities in this level. The hint says "This level should be done in less than 10 bytes of input".    
Looking at the source code, ```sprintf(buffer, string);``` will write formated string data to the buffer. So what we gonna do is to make the string 68 bytes long with "0xdeadbeef" at the end.    
The command is: ```./format0 $(python -c "print '%64s'+'\xef\xbe\xad\xde'")```   
![format0_1](./images/format0_1.png)    


## [Format1](https://exploit-exercises.com/protostar/format1/)
This challenge is an exploitation through pure format strings (3.4.2 in the Stanford's paper).    
First, we run ```objdump -t```. Now we can see the address of variable "target" is 0x08049638. This is our target address to overwrite on.      
[!format1_1](./images/format1_1.png)    
Next, we should find out how many bytes between current position and our input string. Then we can fill the exact number of "%x" to move the pointer to our input string. We will input a bunch of "A" with enough "%x" to partially dump the stack. We can modify the number of "%x" to make it loacte exactly before the first "A".       
Try ```./format1 $(python -c 'print "A"*16+"%x."*100')```, and didn't find the "4141414141". So I modified 100 to 200. Now I did see the bunch of "A"s. 
[!format1_2](./images/format1_2.png)    
Now modify the number to make it locate at first "A".     
[!format1_3](./images/format1_3.png)     
You will find the offset may also be changed with the length of our payload. So I would like to recommand using __Direct Parameter Access__(4.3). This technique make us to uses the ```$``` to directly access a parameter by giving the location. With DPA, we can change the length of "%x" without changing the length of our input string. It can efficiently benefit our exploitation.
[!format1_4](./images/format1_4.png)
The final step is just substitute "$08x" with "$08n". The command is:     
```./format1 $(python -c 'print "\x38\x96\x04\x08"+"_BB"+"%129$08n"')```    
[!format1_5](./images/format1_5.png)
The ```%n``` will write the number of bytes written so far to the given address. It is sure to be greater than 0, so we can hit the success brach. 
    


## [Format2](https://exploit-exercises.com/protostar/format2/)
## [Format3](https://exploit-exercises.com/protostar/format3/)
## [Format4](https://exploit-exercises.com/protostar/format4/)
